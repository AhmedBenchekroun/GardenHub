{% extends "gardenhub/_manage_base.html" %}
{% load static %}

{% block body_class %}schedule_harvest{% endblock %}

{% block content %}
  <form id="new_order" action="" method="post">

    <h1 class="input_title">Plot</h1>
    <div class="plot_select form_container">
      <div class="map icon">
        <i class="fa fa-map-marker" aria-hidden="true"></i>
      </div>
      <select name="plot">
        <option class="default_value" value="" selected data-default>Select a plot...</option>
        {% for plot in plots %}
          <option value="{{ plot.id }}">
            {{ plot }}
          </option>
        {% endfor%}
      </select>
    </div>

    <div class="date_range">
      <div>
        <h1 class="input_title">Start</h1>
        <div class="plot_select form_container">
          <div class="map icon">
            <i class="fa fa-calendar-o" aria-hidden="true"></i>
          </div>
          <input type="date" name="order_start">
        </div>
      </div>

      <div>
        <h1 class="input_title">End</h1>
        <div class="plot_select form_container">
          <div class="map icon">
            <i class="fa fa-calendar-o" aria-hidden="true"></i>
          </div>
          <input type="date" name="order_end">
        </div>
      </div>
    </div>

    <div class="select_crops_bar">
      <h1 class="input_title">Select crops to harvest</h1>
      <h1 class="input_title edit">Edit</h1>
    </div>

    <div class="select_crops">
      <p class="empty-message">You must select a plot before you can choose any crops.</p>
    </div>

    <input class="submit" type="submit">

  </form>
{% endblock %}

{% block extra_scripts %}
  <script>
    /* Select crops to harvest */
    function toggleCheck() {
      var checkbox = this.parentNode.querySelector(".checkbox");

      var icon = this.parentNode.querySelector(".crop_tap_box");

      console.log(checkbox.checked);

      if (checkbox.checked == false) {
        checkbox.checked = true;
        icon.classList.toggle('checked');
      }
      else {
        checkbox.checked = false;
        icon.classList.toggle('checked');
      }
    }

    function checkBoxes() {
      var boxes = document.querySelectorAll(".crop_selector");

      for (var i=0; i<boxes.length; i++) {
          var box = boxes[i];
          var icon = box.querySelector(".crop_tap_box");
          icon.addEventListener("click", toggleCheck);
      }
    }

    /* Plot dropdown element */
    var dropdown = document.querySelector('select[name="plot"]');
    /* Crop picker element */
    var cropPicker = document.querySelector('.select_crops');

    /* Listen for dropdown to change */
    dropdown.addEventListener("change", function(e) {

      /* Get the plot ID that was selected */
      var plotId = this.value;

      /* Function to call for HTTP request */
      var httpRequest = new XMLHttpRequest();
      httpRequest.onreadystatechange = function() {
        if (httpRequest.readyState === XMLHttpRequest.DONE) {
          if (httpRequest.status === 200) {
            cropPicker.innerHTML = httpRequest.responseText;
            checkBoxes();
          } else {
            console.log('There was a problem with the request.');
          }
        }
      }

      /* Make the HTTP request */
      httpRequest.open('GET', '/_ajax/crops-for-plot/'+plotId+'/', true);
      httpRequest.send();
    });
  </script>
{% endblock %}
